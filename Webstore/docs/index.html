<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="Alexville_Afterschool_Shop" content="width=device-width, initial-scale=1.0" />
    <title>Alexville Afterschool Shop</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <link rel="stylesheet" href="./data/styles.css" />
</head>

<body>
    <div id="app">
        <!-- header -->
        <header>
            <h3> {{siteName}} </h3>

            <!-- cart -->
            <div class="cartContainer">
                <button @click="toggleCartDropdown">
                    <span class="cartCount"> {{cartItemCount}} </span>
                    <span class="fas fa-cart-plus"></span>
                </button>

                <!-- dropdown menu -->
                <transition name="slideFade">
                    <div v-if="showDropdownCart" class="cart-dropdown">
                        <!-- build contents list if not empty -->
                        <div v-if="this.cart.length > 0" class="cart-items">
                            <!-- items in cart listed -->
                            <div v-for="item in this.cart" class="cart-item">
                                <span>{{ item.quantity }} </span>
                                <span>{{ item.subject }}</span>
                                <span>£{{ item.price }}</span>
                            </div>

                            <!-- cart total price -->
                            <div class="cartTotalPrice">
                                <span>Total Price: £{{Number(this.totalCartPrice).toFixed(2)}}</span>
                            </div>
                        </div>

                        <!-- empty cart -->
                        <div v-else class="cart-empty">Your cart is empty</div>

                        <!-- footer with checkout button -->
                        <div class="cart-footer">
                            <button @click="openCheckout()" class="checkout-btn">
                                Checkout
                            </button>
                        </div>
                    </div>
                </transition>
            </div>
        </header>


        <!-- navbar -->
        <span class="navBar">
            <span @click="openShop()" class="shopButton">
                Shop
            </span>
            <input type="text" v-model="searchQuery" placeholder="Search…" class="searchInput">
        </span>



        <!-- sort dropdown -->
        <div v-if="showShop" class="sortContainer">
            <label for="sortSelect">Sort By:</label>
            <select id="sortSelect" v-model="sortType">
                <!-- change this to be dynamic later -->
                <option :value="SORT_TYPES.PRICE_DESCENDING">Price High -> Low</value>
                <option :value="SORT_TYPES.PRICE_ASCENDING">Price Low -> High</value>
                <option :value="SORT_TYPES.EARLIEST_FIRST">Earliest -> Latest</value>
                <option :value="SORT_TYPES.EARLIEST_LAST">Latest -> Earliest</value>
                <option :value="SORT_TYPES.RATING_DESCENDING">Rating High -> Low</value>
                <option :value="SORT_TYPES.RATING_ASCENDING">Rating Low -> High</value>
                <option :value="SORT_TYPES.SLOTS_DESCENDING">Vacancies High -> Low</value>
                <option :value="SORT_TYPES.SLOTS_ASCENDING">Vacancies Low -> High</value>
            </select>
        </div>


        <!-- shop grid begins here -->
        <div v-if="showShop" class="scrollable-list">
            <div class="shopContainer">
                <!-- grid containing each 'card' -->
                <div class="activityGrid">

                    <!-- each grid item rendered here -->
                    <div v-for="activity in filteredActivities" :key="activity._id" class="activityCard"
                        @click="expandActivity(activity._id)">
                        <!-- clicking card switches visible object to selected expandedView template below-->

                        <div class="imageContainer">
                            <img :src="activity.image" />
                        </div>
                        <h3 class="activityName">{{ activity.subject }}</h3>

                    </div>
                </div>
            </div>
        </div>


        <!-- expanded activity view -->
        <div v-if="selectedActivity" class="expandedView">
            <!-- exit button at top -->
            <button @click="closeActivity()" class="closeBtn">
                <i class="fa-solid fa-right-from-bracket"></i>
            </button>
            <!-- larger image as icon -->
            <img :src="selectedActivity.image" class="expandedImage" />

            <span class="nameRating">
                <h2>{{ selectedActivity.subject }}</h2>

                <!-- display the rating as stars -->
                <div class="rating">
                    <template v-for="n in 5">
                        <!-- print solid star-->
                        <i v-if="n <= Math.floor(selectedActivity.rating)" class="fa-solid fa-star"></i>
                        <!-- print half star -->
                        <i v-else-if="n - selectedActivity.rating <= 0.5" class="fa-solid fa-star-half-stroke"></i>
                        <!-- print empty star -->
                        <i v-else class="fa-regular fa-star"></i>
                    </template>
                </div>
            </span>

            <div class="vacancies">
                <p>Vacancies: {{ selectedActivity.vacancies - quantityInCart(selectedActivity._id) }}</p>
            </div>

            <span class="priceBuy">
                <p>£{{ Number(selectedActivity.price).toFixed(2) }}</p>
                <button @click="addToCart(selectedActivity)" class="addToCartButton"
                    :disabled="!canAddToCart(selectedActivity._id)"
                    :class="{ disabledAddButton: !canAddToCart(selectedActivity._id) }">
                    Add to Cart
                </button>

            </span>

            <!-- not sure where to put this yet -->
            <div v-html="getDateInfo(selectedActivity.date)"></div>

            <p>{{ selectedActivity.description }}</p>
        </div>


        <!-- checkout form -->
        <div v-if="showCheckout" class="checkoutForm">
            <h2 class="checkoutHeader"> Checkout </h2>
            <div v-if="this.cart.length > 0">
                <h3> Your Items </h3>

                <!-- build each item -->
                <ul>
                    <li v-for="item in this.cart" class="checkoutItemList">
                        <span class="checkoutItemName">
                            {{ item.subject }}
                        </span>
                        <span class="checkoutItemPrice">
                            £{{Number(item.price).toFixed(2)}}
                        </span>

                        <!-- container to handle quantity count and buttons -->
                        <div class="checkoutQuantityContainer">
                            <button @click="removeFromCart(item)">
                                -
                            </button>

                            <span class="checkoutItemQuantity">
                                {{ item.quantity }}
                            </span>

                            <button @click="addToCart(item)">
                                +
                            </button>
                        </div>

                    </li>
                </ul>

                <div class="checkoutTotalPrice">
                    Total: £{{Number(this.totalCartPrice).toFixed(2)}}
                </div>
            </div>

            <!-- customer details form -->
            <div class="customerDetails">
                <label>
                    Full Name:
                    <input type="text" v-model="customer.name" />
                    <span class="inputError" v-if="errors.name">{{ errors.name }}</span>
                </label>

                <label>
                    Phone Number:
                    <input type="text" v-model="customer.phoneNumber" />
                    <span class="inputError" v-if="errors.phone">{{ errors.phone }}</span>
                </label>

                <label>
                    Card Number:
                    <input type="text" v-model="customer.cardNumber" />
                    <span class="inputError" v-if="errors.card">{{ errors.card }}</span>
                </label>

            </div>

            <!-- place order button -->
            <button @click="placeOrder()" class="checkoutButton" :disabled="!isCheckoutValid">
                Place Order
            </button>


            <transition name="checkoutPopup">
                <div v-if="showOrderPopup" class="checkoutPopup">
                    <div class="checkoutPopupBox">
                        <p>Order placed</p>
                        <button @click="closeCheckoutPopup()">OK</button>
                    </div>
                </div>
            </transition>



        </div>



    </div> <!-- end of app -->

    <script src="./data/constants.js"></script>
    <script src="./data/checkout.dto.js"></script>
    <script src="./data/cart.dto.js"></script>
    <script type="module" src="./api/client.js"></script>
    <script type="module" src="./cache.js"></script>
    <script type="module" src="./setup.js"></script>
    <script type="module" src="./app.js"></script>
</body>

</html>